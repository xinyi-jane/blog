---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allUpdates = await getCollection('updates', ({ data }) => !data.draft);

const sortedUpdates = allUpdates.sort((a, b) => 
  b.data.date.getTime() - a.data.date.getTime()
);

// æ¸²æŸ“åŠ¨æ€å†…å®¹
const renderedUpdates = await Promise.all(
  sortedUpdates.map(async (update) => {
    const { Content } = await update.render();
    return { ...update, Content };
  })
);
---

<Layout title="åŠ¨æ€" description="æœ€æ–°åŠ¨æ€">
  <div>
    <div class="mb-12">
      <div class="flex items-center gap-4 mb-4">
        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-rose-200 to-rose-300 flex items-center justify-center text-3xl">
          ğŸ’«
        </div>
        <div>
          <h1 class="text-4xl font-bold text-gray-800">åŠ¨æ€</h1>
          <p class="text-gray-500 mt-1">è®°å½•ç”Ÿæ´»çš„ç‚¹ç‚¹æ»´æ»´</p>
        </div>
      </div>
    </div>
    {sortedUpdates.length === 0 ? (
      <div class="text-center py-16">
        <p class="text-gray-400 text-lg">æš‚æ— åŠ¨æ€</p>
      </div>
    ) : (
      <div class="space-y-6">
        {renderedUpdates.map((update) => (
          <article class="p-6 bg-white/70 backdrop-blur-sm border border-rose-100 rounded-xl shadow-sm hover:shadow-md transition-all">
            <div class="flex items-start gap-4">
              <div class="w-2 h-2 rounded-full bg-rose-400 mt-2 flex-shrink-0"></div>
              <div class="flex-1">
                <time class="text-sm text-gray-400 font-medium">
                  {update.data.date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                  })}
                </time>
                {update.data.title && (
                  <h2 class="text-xl font-bold mb-3 mt-2 text-gray-800">{update.data.title}</h2>
                )}
                <div class="prose prose-sm max-w-none text-gray-600">
                  <update.Content />
                </div>
                {update.data.images && update.data.images.length > 0 && (
                  <div class="mt-5 grid grid-cols-2 md:grid-cols-3 gap-3">
                    {update.data.images.map((img) => (
                      <div class="overflow-hidden rounded-lg shadow-sm hover:shadow-md transition-shadow">
                        <img src={img} alt="" class="w-full h-48 object-cover hover:scale-105 transition-transform duration-300" />
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>
          </article>
        ))}
      </div>
    )}
  </div>
</Layout>

